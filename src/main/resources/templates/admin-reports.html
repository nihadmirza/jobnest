<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8" />
    <title>JobNest – Admin Reports</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.5/css/bootstrap.min.css}" />
    <link rel="stylesheet" href="/webjars/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
        .stat-card {
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .progress-custom {
            height: 25px;
            border-radius: 10px;
            background-color: #e9ecef;
        }

        .progress-bar-custom {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-light-custom">

    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" th:href="@{/}">Job<span>Nest</span></a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/admin/dashboard}">
                            <i class="fa-solid fa-arrow-left me-1"></i> Back to Dashboard
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container py-5">
        <!-- Header -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/admin/dashboard}">Dashboard</a></li>
                <li class="breadcrumb-item active">Reports</li>
            </ol>
        </nav>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="fw-bold mb-1">Platform Reports</h1>
                <p class="text-muted">Analytics and insights</p>
            </div>
        </div>

        <!-- Error Display -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
            <i class="fa-solid fa-exclamation-circle me-2"></i>
            <span th:text="${error}">Error</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Overview Stats -->
        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm stat-card">
                    <div class="card-body text-center p-4">
                        <i class="fa-solid fa-users fa-2x mb-3 icon-accent"></i>
                        <h3 class="fw-bold mb-1" th:text="${totalUsers}">0</h3>
                        <p class="text-muted small mb-0">Total Users</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm stat-card">
                    <div class="card-body text-center p-4">
                        <i class="fa-solid fa-briefcase fa-2x text-success mb-3"></i>
                        <h3 class="fw-bold mb-1" th:text="${activeJobs}">0</h3>
                        <p class="text-muted small mb-0">Active Jobs</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm stat-card">
                    <div class="card-body text-center p-4">
                        <i class="fa-solid fa-paper-plane fa-2x text-warning mb-3"></i>
                        <h3 class="fw-bold mb-1" th:text="${totalApplications}">0</h3>
                        <p class="text-muted small mb-0">Applications</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm stat-card">
                    <div class="card-body text-center p-4">
                        <i class="fa-solid fa-chart-line fa-2x text-info mb-3"></i>
                        <h3 class="fw-bold mb-1" th:text="${avgApplications}">0</h3>
                        <p class="text-muted small mb-0">Avg Apps/Job</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Distribution -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="fw-bold mb-0"><i class="fa-solid fa-users-gear me-2 icon-accent"></i> User Distribution</h5>
            </div>
            <div class="card-body p-4">
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Recruiters</span>
                        <span class="badge bg-primary" th:text="${recruiters}">0</span>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar progress-bar-custom" role="progressbar"
                            th:style="'width: ' + ${totalUsers > 0 ? (recruiters * 100.0 / totalUsers) : 0} + '%'">
                        </div>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Job Seekers</span>
                        <span class="badge bg-success" th:text="${jobSeekers}">0</span>
                    </div>
                    <div class="progress progress-custom">
                        <div class="progress-bar bg-success" role="progressbar"
                            th:style="'width: ' + ${totalUsers > 0 ? (jobSeekers * 100.0 / totalUsers) : 0} + '%'">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Performers Row -->
        <div class="row g-4 mb-4">
            <!-- Top Jobs -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="fw-bold mb-0"><i class="fa-solid fa-fire me-2 text-danger"></i> Top Jobs</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <div th:each="entry, stat : ${topJobs}" class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="text-truncate me-2">
                                        <span class="badge bg-secondary me-2" th:text="${stat.index + 1}">1</span>
                                        <span class="fw-semibold" th:text="${entry.key.title}">Job Title</span>
                                    </div>
                                    <span class="badge bg-primary" th:text="${entry.value} + ' apps'">0</span>
                                </div>
                            </div>
                            <div th:if="${topJobs == null || topJobs.isEmpty()}"
                                class="list-group-item text-center text-muted">
                                No data available
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Recruiters -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="fw-bold mb-0"><i class="fa-solid fa-trophy me-2 text-warning"></i> Top Recruiters
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <div th:each="entry, stat : ${topRecruiters}" class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="text-truncate me-2">
                                        <span class="badge bg-secondary me-2" th:text="${stat.index + 1}">1</span>
                                        <span class="fw-semibold"
                                            th:text="${entry.key.company ?: entry.key.firstName}">Name</span>
                                    </div>
                                    <span class="badge bg-success" th:text="${entry.value} + ' jobs'">0</span>
                                </div>
                            </div>
                            <div th:if="${topRecruiters == null || topRecruiters.isEmpty()}"
                                class="list-group-item text-center text-muted">
                                No data available
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Job Seekers -->
            <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-white py-3">
                        <h5 class="fw-bold mb-0"><i class="fa-solid fa-star me-2 text-info"></i> Top Job Seekers</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <div th:each="entry, stat : ${topJobSeekers}" class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="text-truncate me-2">
                                        <span class="badge bg-secondary me-2" th:text="${stat.index + 1}">1</span>
                                        <span class="fw-semibold" th:text="${entry.key.email}">Email</span>
                                    </div>
                                    <span class="badge bg-warning text-dark" th:text="${entry.value} + ' apps'">0</span>
                                </div>
                            </div>
                            <div th:if="${topJobSeekers == null || topJobSeekers.isEmpty()}"
                                class="list-group-item text-center text-muted">
                                No data available
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer>
        <div class="container">
            <p class="mb-0">Copyright © <span th:text="${#dates.format(#dates.createNow(), 'yyyy')}">2026</span> JobNest Admin Panel. All rights reserved.</p>
        </div>
    </footer>

    <script th:src="@{/webjars/bootstrap/5.3.5/js/bootstrap.bundle.min.js}"></script>
</body>

</html>